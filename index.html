<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –ö—É—Ä—Å—ã v1.24 Precision</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#0F0F0F',
                        card: '#18181B',
                        hover: '#27272A',
                        accent: '#27D566',
                        text: '#FFFFFF',
                        subtext: '#A1A1AA',
                        border: '#27272A'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'fade-in-centered': 'fadeInCentered 0.5s ease-out', 
                        'slide-up-centered': 'slideUpCentered 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(-10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeInCentered: {
                            '0%': { opacity: '0', transform: 'translate(-50%, -20px)' },
                            '100%': { opacity: '1', transform: 'translate(-50%, 0)' },
                        },
                        slideUpCentered: {
                            '0%': { opacity: '0', transform: 'translate(-50%, 20px)' },
                            '100%': { opacity: '1', transform: 'translate(-50%, 0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0F0F0F; color: #FFFFFF; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0F0F0F; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
        
        .circle-progress {
            transition: stroke-dashoffset 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
    </style>

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%234ade80' /%3E%3Cstop offset='100%25' stop-color='%23166534' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='120' fill='url(%23grad)'/%3E%3Cg transform='translate(256 256) scale(0.55) translate(-256 -256)'%3E%3Cpath d='M256 130L48 240L256 350L464 240L256 130Z' stroke='%230F0F0F' stroke-width='36' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M112 274V380C112 380 160 420 256 420C352 420 400 380 400 380V274' stroke='%230F0F0F' stroke-width='36' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cline x1='464' y1='240' x2='464' y2='360' stroke='%230F0F0F' stroke-width='36' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='444' y='360' width='40' height='50' rx='10' fill='%230F0F0F' stroke='none'/%3E%3C/g%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%234ade80' /%3E%3Cstop offset='100%25' stop-color='%23166534' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='120' fill='url(%23grad)'/%3E%3Cg transform='translate(256 256) scale(0.55) translate(-256 -256)'%3E%3Cpath d='M256 130L48 240L256 350L464 240L256 130Z' stroke='%230F0F0F' stroke-width='36' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M112 274V380C112 380 160 420 256 420C352 420 400 380 400 380V274' stroke='%230F0F0F' stroke-width='36' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cline x1='464' y1='240' x2='464' y2='360' stroke='%230F0F0F' stroke-width='36' stroke-linecap='round' stroke-linejoin='round'/%3E%3Crect x='444' y='360' width='40' height='50' rx='10' fill='%230F0F0F' stroke='none'/%3E%3C/g%3E%3C/svg%3E">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- –ë–ê–ó–ê –¶–ò–¢–ê–¢ ---
        const QUOTES = [
            { text: "–ß–µ—Ä–µ–∑ –≥–æ–¥ –≤—ã –±—É–¥–µ—Ç–µ –∂–∞–ª–µ—Ç—å, —á—Ç–æ –Ω–µ –Ω–∞—á–∞–ª–∏ —Å–µ–≥–æ–¥–Ω—è.", author: "–ö–∞—Ä–µ–Ω –õ—ç–º–±" },
            { text: "–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ—Å—å, –∫–æ–≥–¥–∞ —É—Å—Ç–∞–ª–∏. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ—Å—å, –∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏.", author: "–ú—ç—Ä–∏–ª–∏–Ω –ú–æ–Ω—Ä–æ" },
            { text: "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –∑–Ω–∞–Ω–∏—è –ø–ª–∞—Ç—è—Ç –ª—É—á—à–∏–µ –¥–∏–≤–∏–¥–µ–Ω–¥—ã.", author: "–ë–µ–Ω–¥–∂–∞–º–∏–Ω –§—Ä–∞–Ω–∫–ª–∏–Ω" },
            { text: "–í–∞—à–µ –≤—Ä–µ–º—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ, –Ω–µ —Ç—Ä–∞—Ç—å—Ç–µ –µ–≥–æ, –∂–∏–≤—è —á—É–∂–æ–π –∂–∏–∑–Ω—å—é.", author: "–°—Ç–∏–≤ –î–∂–æ–±—Å" },
            { text: "–£—Å–ø–µ—Ö ‚Äî —ç—Ç–æ —Å—É–º–º–∞ –Ω–µ–±–æ–ª—å—à–∏—Ö —É—Å–∏–ª–∏–π, –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∏–∑–æ –¥–Ω—è –≤ –¥–µ–Ω—å.", author: "–†–æ–±–µ—Ä—Ç –ö–æ–ª—å–µ—Ä" },
            { text: "–õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –±—É–¥—É—â–µ–µ ‚Äî —Å–æ–∑–¥–∞—Ç—å –µ–≥–æ.", author: "–ü–∏—Ç–µ—Ä –î—Ä—É–∫–µ—Ä" },
            { text: "–û–±—É—á–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∂–∏–∑–Ω–∏, —ç—Ç–æ –∏ –µ—Å—Ç—å —Å–∞–º–∞ –∂–∏–∑–Ω—å.", author: "–î–∂–æ–Ω –î—å—é–∏" },
            { text: "–ß–µ–º –±–æ–ª—å—à–µ —è —É—á—É—Å—å, —Ç–µ–º –±–æ–ª—å—à–µ –ø–æ–Ω–∏–º–∞—é, –∫–∞–∫ –º–∞–ª–æ —è –∑–Ω–∞—é.", author: "–ê–ª—å–±–µ—Ä—Ç –≠–π–Ω—à—Ç–µ–π–Ω" },
            { text: "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ ‚Äî —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –¥–µ–ª–∞—Ç—å —Ç–æ, —á–µ–≥–æ –æ—á–µ–Ω—å –Ω–µ —Ö–æ—á–µ—Ç—Å—è –¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∏—á—å —Ç–æ–≥–æ, —á–µ–≥–æ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è –¥–æ—Å—Ç–∏—á—å.", author: "–î–∂–æ–Ω –ú–∞–∫—Å–≤–µ–ª–ª" },
            { text: "–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫—É–ø–ª–µ–Ω–æ –ª–∏—à—å —á—Ç–µ–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.", author: "–ù–∞–ø–æ–ª–µ–æ–Ω –•–∏–ª–ª" },
            { text: "–ù–∞—á–∏–Ω–∞—Ç—å –≤—Å–µ–≥–¥–∞ —Å—Ç—Ä–∞—à–Ω–æ, –Ω–æ –µ—â–µ —Å—Ç—Ä–∞—à–Ω–µ–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –Ω–∞—á–∞—Ç—å.", author: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π" },
            { text: "–í—á–µ—Ä–∞ ‚Äî —ç—Ç–æ –∏—Å—Ç–æ—Ä–∏—è, –∑–∞–≤—Ç—Ä–∞ ‚Äî —ç—Ç–æ —Ç–∞–π–Ω–∞, –∞ —Å–µ–≥–æ–¥–Ω—è ‚Äî —ç—Ç–æ –ø–æ–¥–∞—Ä–æ–∫.", author: "–ë–∏–ª–ª –ö–∏–Ω" },
            { text: "–°–µ–∫—Ä–µ—Ç —É—Å–ø–µ—Ö–∞ ‚Äî –≤ –ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–µ —Ü–µ–ª–∏.", author: "–ë–µ–Ω–¥–∂–∞–º–∏–Ω –î–∏–∑—Ä–∞—ç–ª–∏" },
            { text: "–ù–µ –±–æ–π—Ç–µ—Å—å —Ä–∞—Å—Ç–∏ –º–µ–¥–ª–µ–Ω–Ω–æ, –±–æ–π—Ç–µ—Å—å –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏.", author: "–ö–∏—Ç–∞–π—Å–∫–∞—è –ø–æ—Å–ª–æ–≤–∏—Ü–∞" },
            { text: "–õ—é–±–æ–π —ç–∫—Å–ø–µ—Ä—Ç –∫–æ–≥–¥–∞-—Ç–æ –±—ã–ª –Ω–æ–≤–∏—á–∫–æ–º.", author: "–•–µ–ª–µ–Ω –•–µ–π—Å" }
        ];

        // --- –ò–ö–û–ù–ö–ò ---
        const IconFolder = ({size=24, filled}) => <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 2H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/></svg>;
        const IconCheck = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#27D566" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const IconCircle = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#52525B" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/></svg>;
        const IconChevronRight = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>;
        const IconChevronDown = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>;
        const IconTrash = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const IconPlus = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const IconBack = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>;
        const IconVideo = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></svg>;
        const IconStar = ({filled}) => <svg width="18" height="18" viewBox="0 0 24 24" fill={filled ? "#F59E0B" : "none"} stroke={filled ? "#F59E0B" : "#52525B"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
        const IconRefresh = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>;
        const IconDownload = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const IconUpload = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
        const IconHelp = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>;
        const IconEye = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>;
        const IconEyeOff = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>;
        const IconEdit = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>;
        const IconCloud = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>;
        const IconQuote = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" className="text-accent/20"><path d="M14.017 21L14.017 18C14.017 16.8954 14.9124 16 16.017 16H19.017C19.5693 16 20.017 15.5523 20.017 15V9C20.017 8.44772 19.5693 8 19.017 8H15.017C14.4647 8 14.017 8.44772 14.017 9V11C14.017 11.5523 13.5693 12 13.017 12H12.017V5H22.017V15C22.017 18.3137 19.3307 21 16.017 21H14.017ZM5.0166 21L5.0166 18C5.0166 16.8954 5.91203 16 7.0166 16H10.0166C10.5689 16 11.0166 15.5523 11.0166 15V9C11.0166 8.44772 10.5689 8 10.0166 8H6.0166C5.46432 8 5.0166 8.44772 5.0166 9V11C5.0166 11.5523 4.56889 12 4.0166 12H3.0166V5H13.0166V15C13.0166 18.3137 10.3303 21 7.0166 21H5.0166Z" /></svg>;
        
        // FIXED ICON MORTARBOARD (Clean, Big size via prop)
        const IconMortarboard = ({size=24, className=""}) => (
            <svg width={size} height={size} viewBox="0 0 512 512" fill="none" stroke="currentColor" strokeWidth="28" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M256 130L48 240L256 350L464 240L256 130Z"/>
                <path d="M112 274V380C112 380 160 420 256 420C352 420 400 380 400 380V274"/>
                <line x1="464" y1="240" x2="464" y2="360" />
                <rect x="444" y="360" width="40" height="50" rx="10" fill="currentColor" stroke="none"/>
            </svg>
        );


        // --- –ö–û–ú–ü–û–ù–ï–ù–¢–´ ---
        
        const CircularProgress = ({ percentage, size = 80, strokeWidth = 8 }) => {
            const radius = (size - strokeWidth) / 2;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (percentage / 100) * circumference;

            // Format for display: remove .0 if it's an integer
            const displayPercentage = percentage % 1 === 0 ? percentage.toFixed(0) : percentage.toFixed(1);

            return (
                <div className="relative flex items-center justify-center select-none" style={{ width: size, height: size }}>
                    <svg width={size} height={size} className="transform -rotate-90 drop-shadow-lg">
                        <circle cx={size / 2} cy={size / 2} r={radius} stroke="#27272A" strokeWidth={strokeWidth} fill="transparent" />
                        <circle className="circle-progress" cx={size / 2} cy={size / 2} r={radius} stroke="#27D566" strokeWidth={strokeWidth} fill="transparent" strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" />
                    </svg>
                    <span className="absolute text-lg font-bold text-white">{displayPercentage}%</span>
                </div>
            );
        };

        const StarRating = ({ rating, onRate }) => {
            const [hover, setHover] = useState(0);
            return (
                <div className="flex gap-1" onMouseLeave={() => setHover(0)}>
                    {[1, 2, 3, 4, 5].map((star) => (
                        <div 
                            key={star}
                            className="cursor-pointer transition-transform hover:scale-110"
                            onMouseEnter={() => setHover(star)}
                            onClick={(e) => { e.stopPropagation(); onRate(star); }}
                        >
                            <IconStar filled={star <= (hover || rating)} />
                        </div>
                    ))}
                </div>
            );
        };

        const QuoteBlock = () => {
            const [quote, setQuote] = useState(null);
            useEffect(() => { setQuote(QUOTES[Math.floor(Math.random() * QUOTES.length)]); }, []);
            if (!quote) return null;

            return (
                <div className="w-full bg-card border border-border rounded-2xl p-6 mb-8 flex gap-4 items-start relative overflow-hidden animate-fade-in group hover:border-accent/30 transition-colors">
                    <div className="text-accent shrink-0 mt-1"><IconQuote /></div>
                    <div className="relative z-10 flex-grow">
                        <p className="text-lg text-white font-medium italic mb-2 leading-relaxed">"{quote.text}"</p>
                        <p className="text-sm text-subtext font-mono">‚Äî {quote.author}</p>
                    </div>
                    <div className="text-accent shrink-0 mt-1 transform rotate-180"><IconQuote /></div>
                </div>
            );
        };

        const Toast = ({ message, type = 'success', onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            // Hide cloud icon specifically for 'celebration'
            const isCelebration = type === 'celebration';

            return (
                <div className={`fixed top-6 left-1/2 -translate-x-1/2 z-[60] px-6 py-4 rounded-xl shadow-2xl animate-fade-in-centered flex items-center gap-3 border whitespace-nowrap ${type === 'error' ? 'bg-red-900/90 border-red-500/50 text-white' : 'bg-[#1C1C20]/90 border-accent/30 text-white'}`}>
                    {!isCelebration && type === 'success' ? <div className="text-accent"><IconCloud /></div> : null}
                    <span className="font-medium">{message}</span>
                </div>
            );
        };

        const CloudSyncModal = ({ onClose, onSync, onLoad, config, setConfig }) => {
            const [status, setStatus] = useState(null); // 'loading', 'success', 'error'
            const [msg, setMsg] = useState('');

            const handleSave = () => {
                localStorage.setItem('vibe_jsonbin_config', JSON.stringify(config));
                setMsg('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ');
                setStatus('success');
                setTimeout(() => setStatus(null), 2000);
            };

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                    <div className="bg-card border border-border rounded-2xl p-8 max-w-lg w-full shadow-2xl animate-fade-in">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold flex items-center gap-2"><IconCloud /> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è JSONBin</h2>
                            <button onClick={onClose} className="text-subtext hover:text-white"><IconBack /></button>
                        </div>
                        
                        <div className="space-y-4 mb-6">
                            <div>
                                <label className="block text-sm text-subtext mb-1">X-Master-Key (API Key)</label>
                                <input 
                                    type="password" 
                                    value={config.key} 
                                    onChange={(e) => setConfig({...config, key: e.target.value})}
                                    className="w-full bg-bg border border-border rounded-lg px-4 py-2 text-white focus:border-accent outline-none"
                                    placeholder="–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å $2a$..."
                                />
                            </div>
                            <div>
                                <label className="block text-sm text-subtext mb-1">Bin ID</label>
                                <input 
                                    type="text" 
                                    value={config.binId} 
                                    onChange={(e) => setConfig({...config, binId: e.target.value})}
                                    className="w-full bg-bg border border-border rounded-lg px-4 py-2 text-white focus:border-accent outline-none"
                                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 65123abc..."
                                />
                            </div>
                            <button onClick={handleSave} className="text-xs text-accent hover:underline">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á–∏</button>
                        </div>

                        {status && (
                            <div className={`mb-4 p-3 rounded-lg text-sm text-center ${status === 'error' ? 'bg-red-500/10 text-red-500' : 'bg-accent/10 text-accent'}`}>
                                {msg}
                            </div>
                        )}

                        <div className="grid grid-cols-2 gap-4">
                            <button 
                                onClick={() => { setStatus('loading'); setMsg('–í—ã–≥—Ä—É–∑–∫–∞...'); onSync(setStatus, setMsg); }}
                                disabled={!config.key || !config.binId}
                                className="flex flex-col items-center justify-center gap-2 p-4 bg-bg border border-border rounded-xl hover:border-accent hover:bg-hover transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <IconUpload />
                                <span className="font-bold">–í—ã–≥—Ä—É–∑–∏—Ç—å –≤ –æ–±–ª–∞–∫–æ</span>
                                <span className="text-xs text-subtext">–õ–æ–∫–∞–ª—å–Ω—ã–µ -> –û–±–ª–∞–∫–æ</span>
                            </button>
                            <button 
                                onClick={() => { setStatus('loading'); setMsg('–ó–∞–≥—Ä—É–∑–∫–∞...'); onLoad(setStatus, setMsg); }}
                                disabled={!config.key || !config.binId}
                                className="flex flex-col items-center justify-center gap-2 p-4 bg-bg border border-border rounded-xl hover:border-accent hover:bg-hover transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <IconDownload />
                                <span className="font-bold">–°–∫–∞—á–∞—Ç—å –∏–∑ –æ–±–ª–∞–∫–∞</span>
                                <span className="text-xs text-subtext">–û–±–ª–∞–∫–æ -> –õ–æ–∫–∞–ª—å–Ω—ã–µ</span>
                            </button>
                        </div>
                        <div className="mt-6 text-center">
                            <a href="https://jsonbin.io/login" target="_blank" className="text-sm text-subtext hover:text-white underline decoration-dashed">–ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏ –Ω–∞ JSONBin.io</a>
                        </div>
                    </div>
                </div>
            );
        };

        // --- –õ–û–ì–ò–ö–ê ---

        async function scanEntry(entry) {
            if (entry.kind === 'file') {
                if (entry.name.startsWith('.') || entry.name.endsWith('.db') || entry.name.endsWith('.ini')) return null;
                return { name: entry.name, kind: 'file', id: Math.random().toString(36).substr(2, 9) };
            } else if (entry.kind === 'directory') {
                let children = [];
                for await (const child of entry.values()) {
                    const scannedChild = await scanEntry(child);
                    if (scannedChild) children.push(scannedChild);
                }
                
                // --- NATURAL SORT FIX ---
                children.sort((a, b) => {
                    if (a.kind === b.kind) {
                        return a.name.localeCompare(b.name, undefined, { numeric: true, sensitivity: 'base' });
                    }
                    return a.kind === 'directory' ? -1 : 1;
                });
                // --- NATURAL SORT FIX END ---

                if (children.length === 0) return null;
                return { name: entry.name, kind: 'directory', children, id: Math.random().toString(36).substr(2, 9) };
            }
        }

        function mergeStructure(newStruct, oldStruct) {
            if (!oldStruct) return newStruct;
            if (newStruct.kind === 'file' && oldStruct.kind === 'file' && newStruct.name === oldStruct.name) {
                return { ...newStruct, id: oldStruct.id };
            }
            if (newStruct.kind === 'directory' && oldStruct.kind === 'directory') {
                const newChildren = newStruct.children.map(newChild => {
                    const oldChild = oldStruct.children.find(oc => oc.name === newChild.name);
                    return mergeStructure(newChild, oldChild);
                });
                return { ...newStruct, children: newChildren, id: oldStruct.id };
            }
            return newStruct;
        }

        function countFiles(node, excludedMap = {}) {
            if (!node) return 0;
            if (node.kind === 'file') {
                return excludedMap[node.id] ? 0 : 1;
            }
            return node.children.reduce((acc, child) => acc + countFiles(child, excludedMap), 0);
        }
        function countCompletedFiles(node, completedMap, excludedMap = {}) {
            if (!node) return 0;
            if (node.kind === 'file') {
                if (excludedMap[node.id]) return 0;
                return completedMap[node.id] ? 1 : 0;
            }
            return node.children.reduce((acc, child) => acc + countCompletedFiles(child, completedMap, excludedMap), 0);
        }

        const FileTree = ({ node, completedMap, ratingsMap, excludedMap = {}, expandedMap = {}, onToggle, onRate, onExclude, onToggleFolder }) => {
            const folderStats = useMemo(() => {
                if (node.kind !== 'directory') return null;
                const total = countFiles(node, excludedMap);
                const completed = countCompletedFiles(node, completedMap, excludedMap);
                const percent = total === 0 ? 0 : Math.round((completed / total) * 100);
                return { total, completed, percent };
            }, [node, completedMap, excludedMap]);

            if (node.kind === 'file') {
                const isCompleted = completedMap[node.id];
                const rating = ratingsMap[node.id] || 0;
                const isExcluded = excludedMap[node.id];

                return (
                    <div className={`group flex flex-col sm:flex-row sm:items-center justify-between py-3 px-3 sm:px-4 rounded-xl mb-1 border border-transparent transition-all
                            ${isExcluded ? 'opacity-40 grayscale' : (isCompleted ? 'bg-accent/5 border-accent/10' : 'hover:bg-hover hover:border-border')}`}>
                        <div onClick={() => !isExcluded && onToggle(node.id)} className={`flex items-center gap-3 sm:gap-5 flex-grow min-w-0 w-full sm:w-auto sm:mr-4 ${isExcluded ? 'cursor-default' : 'cursor-pointer'}`}>
                            <div className={`shrink-0 transition-transform duration-200 ${isCompleted && !isExcluded ? 'scale-110' : 'group-hover:scale-110'}`}>
                                {isCompleted ? <IconCheck /> : <IconCircle />}
                            </div>
                            <div className={`shrink-0 ${isCompleted ? 'text-accent/40' : 'text-subtext'}`}><IconVideo /></div>
                            <div className={`text-base sm:text-lg font-medium break-words whitespace-normal select-none transition-colors ${isCompleted ? 'text-subtext line-through opacity-60' : 'text-text'}`}>
                                {node.name}
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            {/* Stars: Always visible */}
                            <div className={`flex items-center justify-end w-full sm:w-auto mt-2 sm:mt-0 opacity-100 transition-opacity ${isExcluded ? 'invisible' : ''}`}>
                                <StarRating rating={rating} onRate={(r) => onRate(node.id, r)} />
                            </div>
                            {/* Eye: Always visible, dimmed when inactive */}
                             <div 
                                onClick={(e) => { e.stopPropagation(); onExclude(node.id); }}
                                className={`cursor-pointer p-2 rounded-lg hover:bg-white/10 text-subtext hover:text-white transition-all opacity-100`}
                                title={isExcluded ? "–í–∫–ª—é—á–∏—Ç—å –≤ –ø—Ä–æ–≥—Ä–µ—Å—Å" : "–ò—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞"}
                            >
                                {isExcluded ? <IconEyeOff /> : <IconEye />}
                            </div>
                        </div>
                    </div>
                );
            }

            const isFolderCompleted = folderStats.percent === 100;
            // Determine if folder is open based on saved state (default false)
            const isOpen = expandedMap[node.id];

            return (
                <div className="mb-4 mt-3">
                    <div onClick={() => onToggleFolder(node.id)} className="flex items-center justify-between py-2 px-2 rounded-lg cursor-pointer hover:bg-hover select-none group w-full">
                        <div className="flex items-center gap-3">
                            <span className="text-subtext group-hover:text-text transition-colors bg-card p-1.5 rounded-lg border border-border group-hover:border-subtext">
                                {isOpen ? <IconChevronDown /> : <IconChevronRight />}
                            </span>
                            <span className={isFolderCompleted ? "text-subtext opacity-50" : "text-yellow-500/90"}><IconFolder size={28} /></span>
                            <span className={`font-bold text-xl tracking-tight transition-colors ${isFolderCompleted ? 'text-subtext line-through opacity-60 decoration-2' : 'group-hover:text-white text-gray-200'}`}>
                                {node.name}
                            </span>
                        </div>
                        <div className={`text-sm font-mono font-bold px-3 py-1 rounded-full border ${isFolderCompleted ? 'bg-accent/10 text-accent border-accent/20' : 'bg-card text-subtext border-border'}`}>
                            {folderStats.percent}%
                        </div>
                    </div>
                    {isOpen && (
                        <div className="border-l-2 border-border ml-[21px] pl-5 mt-2 space-y-1">
                            {node.children.map(child => (
                                <FileTree key={child.id} node={child} completedMap={completedMap} ratingsMap={ratingsMap} excludedMap={excludedMap} expandedMap={expandedMap} onToggle={onToggle} onRate={onRate} onExclude={onExclude} onToggleFolder={onToggleFolder} />
                            ))}
                        </div>
                    )}
                </div>
            );
        };
        const HelpScreen = ({ onClose }) => (
            <div className="fixed inset-0 bg-[#0F0F0F] z-50 overflow-y-auto p-6 md:p-12">
                <div className="max-w-3xl mx-auto">
                    <button onClick={onClose} className="mb-8 flex items-center gap-2 text-subtext hover:text-white transition-colors bg-card px-4 py-2 rounded-lg border border-border">
                        <IconBack /> –ù–∞–∑–∞–¥
                    </button>

                    <h1 className="text-4xl font-bold mb-8">–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É</h1>
                    <div className="space-y-8">
                        <section className="bg-card p-6 rounded-2xl border border-border">
                            <h2 className="text-2xl font-bold mb-4 flex items-center gap-3"><IconPlus /> –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞</h2>
                            <p className="text-subtext mb-4">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>¬´–î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å¬ª</b> –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ. –¢—Ä–µ–∫–µ—Ä –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä—É–µ—Ç –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏.</p>
                            <div className="bg-bg p-4 rounded-lg border border-border text-sm text-yellow-500/80">
                                üí° –°–æ–≤–µ—Ç: –õ—É—á—à–µ –≤—ã–±–∏—Ä–∞—Ç—å –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É –∫—É—Ä—Å–∞, –≥–¥–µ –ª–µ–∂–∞—Ç –ø–∞–ø–∫–∏ —Å –º–æ–¥—É–ª—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ú–æ–¥—É–ª—å 1", "–ú–æ–¥—É–ª—å 2").
                            </div>
                        </section>

                        <section className="bg-card p-6 rounded-2xl border border-border">
                            <h2 className="text-2xl font-bold mb-4 flex items-center gap-3"><IconCloud /> –û–±–ª–∞—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</h2>
                            <p className="text-subtext mb-2">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–õ–æ–∫–∞–ª—å–Ω–æ). –û–±–ª–∞–∫–æ –Ω—É–∂–Ω–æ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.</p>
                            <p className="text-subtext mb-2">–ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –æ–±–ª–∞–∫–æ:</p>
                            <ol className="list-decimal list-inside text-subtext space-y-2 ml-2 mb-2">
                                <li>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ <a href="https://jsonbin.io" target="_blank" className="text-accent underline">jsonbin.io</a></li>
                                <li>–°–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç–æ–π Bin (Public: Private). –°–∫–æ–ø–∏—Ä—É–π—Ç–µ <b>Bin ID</b>.</li>
                                <li>–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è (API Keys) —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ <b>Master Key</b>.</li>
                                <li>–ù–∞–∂–º–∏—Ç–µ –∏–∫–æ–Ω–∫—É –æ–±–ª–∞–∫–∞ –≤ —Ç—Ä–µ–∫–µ—Ä–µ, –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ.</li>
                            </ol>
                        </section>

                        <section className="bg-card p-6 rounded-2xl border border-border">
                            <h2 className="text-2xl font-bold mb-4 flex items-center gap-3"><IconEdit /> –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞</h2>
                            <p className="text-subtext">–†—è–¥–æ–º —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∫—É—Ä—Å–∞ –µ—Å—Ç—å –∏–∫–æ–Ω–∫–∞ –∫–∞—Ä–∞–Ω–¥–∞—à–∞. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ—ë, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ —Ç–µ–≥–∏ <i>[slwbl]</i>). –≠—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–∞–ø–∫—É –Ω–∞ –¥–∏—Å–∫–µ.</p>
                        </section>

                        <section className="bg-card p-6 rounded-2xl border border-border">
                            <h2 className="text-2xl font-bold mb-4 flex items-center gap-3"><IconDownload /> –ë—ç–∫–∞–ø –∏ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</h2>
                            <p className="text-subtext mb-2">–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –ß—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∫—ç—à–∞:</p>
                            <ul className="list-disc list-inside text-subtext space-y-2 ml-2">
                                <li><b>–ë—ç–∫–∞–ø:</b> –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª .json —Å–æ –≤—Å–µ–º–∏ –≤–∞—à–∏–º–∏ –∫—É—Ä—Å–∞–º–∏ –∏ –æ—Ç–º–µ—Ç–∫–∞–º–∏.</li>
                                <li><b>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:</b> –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ .json —Ñ–∞–π–ª–∞ (–≤–Ω–∏–º–∞–Ω–∏–µ: —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã!).</li>
                            </ul>
                        </section>

                        <section className="bg-card p-6 rounded-2xl border border-border">
                            <h2 className="text-2xl font-bold mb-4 flex items-center gap-3"><IconRefresh /> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (–†–µ—Å–∫–∞–Ω)</h2>
                            <p className="text-subtext">–ï—Å–ª–∏ –≤—ã —Å–∫–∞—á–∞–ª–∏ –Ω–æ–≤—ã–µ —É—Ä–æ–∫–∏ –≤ –ø–∞–ø–∫—É –∫—É—Ä—Å–∞, –∑–∞–π–¥–∏—Ç–µ –≤–Ω—É—Ç—Ä—å –∫—É—Ä—Å–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>¬´–û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã¬ª</b> (—Å–ø—Ä–∞–≤–∞ –æ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è). –í—ã–±–µ—Ä–∏—Ç–µ —Ç—É –∂–µ –ø–∞–ø–∫—É –∑–∞–Ω–æ–≤–æ. –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –ø–æ—è–≤—è—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ, –∞ –≤–∞—à–∏ —Å—Ç–∞—Ä—ã–µ –æ—Ç–º–µ—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è.</p>
                        </section>

                        <section className="bg-card p-6 rounded-2xl border border-border">
                            <h2 className="text-2xl font-bold mb-4 flex items-center gap-3"><IconEye /> –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h2>
                            <p className="text-subtext">–°–ø—Ä–∞–≤–∞ –æ—Ç –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –µ—Å—Ç—å –∏–∫–æ–Ω–∫–∞ –≥–ª–∞–∑–∞. –ù–∞–∂–º–∏—Ç–µ –µ—ë, —á—Ç–æ–±—ã <b>–∏—Å–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª</b> –∏–∑ —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–ª—ã –∑–∞–¥–∞–Ω–∏–π –∏–ª–∏ –¥–æ–ø. –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤). –§–∞–π–ª —Å—Ç–∞–Ω–µ—Ç —Å–µ—Ä—ã–º, –∞ –∏–∫–æ–Ω–∫–∞ —Å–º–µ–Ω–∏—Ç—Å—è –Ω–∞ –ø–µ—Ä–µ—á–µ—Ä–∫–Ω—É—Ç—ã–π –≥–ª–∞–∑.</p>
                        </section>

                        <section className="bg-card p-6 rounded-2xl border border-border">
                            <h2 className="text-2xl font-bold mb-4 flex items-center gap-3"><IconStar filled={true} /> –û—Ü–µ–Ω–∫–∞ —É—Ä–æ–∫–æ–≤</h2>
                            <p className="text-subtext">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–≤–µ–∑–¥—ã —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å–ø—Ä–∞–≤–∞ –æ—Ç —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã –æ—Ç–º–µ—Ç–∏—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–µ —É—Ä–æ–∫–∏.</p>
                        </section>
                    </div>
                </div>
            </div>
        );

        const App = () => {
            const [courses, setCourses] = useState(() => {
                const saved = localStorage.getItem('vibe_courses');
                return saved ? JSON.parse(saved) : [];
            });
            const [activeCourseId, setActiveCourseId] = useState(null);
            const [showHelp, setShowHelp] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const fileInputRef = useRef(null);
            const editInputRef = useRef(null);
            const [notification, setNotification] = useState(null); // { msg, type }
            const [unsavedChanges, setUnsavedChanges] = useState(false); // Track changes in active course

            // Ref to store current courses state for async operations (CRITICAL FIX FOR SYNC)
            const coursesRef = useRef(courses);

            // Cloud Sync States
            const [showCloud, setShowCloud] = useState(false);
            const [cloudConfig, setCloudConfig] = useState(() => {
                const saved = localStorage.getItem('vibe_jsonbin_config');
                return saved ? JSON.parse(saved) : { key: '', binId: '' };
            });

            // CHECK IF CLOUD IS CONFIGURED
            const isCloudConfigured = cloudConfig.key && cloudConfig.binId;

            // Keep Ref in sync with state
            useEffect(() => { 
                coursesRef.current = courses;
                localStorage.setItem('vibe_courses', JSON.stringify(courses)); 
            }, [courses]);

            useEffect(() => { if (editingId && editInputRef.current) editInputRef.current.focus(); }, [editingId]);

            // AUTO-SYNC ON LOAD
            useEffect(() => {
                if (isCloudConfigured) {
                    // Silently fetch on load
                    fetch(`https://api.jsonbin.io/v3/b/${cloudConfig.binId}`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': cloudConfig.key,
                             'X-Bin-Meta': 'false' 
                        }
                    })
                    .then(res => {
                        if(res.ok) return res.json();
                        throw new Error('Sync Failed');
                    })
                    .then(data => {
                        let coursesData = data.record || data;
                        // Handle new wrapper format
                        if (coursesData.courses && Array.isArray(coursesData.courses)) {
                            coursesData = coursesData.courses;
                        }
                        
                        if(Array.isArray(coursesData)) {
                            setCourses(coursesData);
                            setNotification({msg: '–û–±–ª–∞–∫–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ', type: 'success'});
                        }
                    })
                    .catch(err => {
                        console.error("Auto-sync error", err);
                        // Optional: notify error, or stay silent to not annoy user offline
                    });
                }
            }, []);

            const showToast = (msg, type='success') => {
                setNotification({msg, type});
                setTimeout(() => setNotification(null), 3000);
            }

            const handleAddCourse = async () => {
                try {
                    const dirHandle = await window.showDirectoryPicker();
                    const structure = await scanEntry(dirHandle);
                    if (!structure) return alert("–ü–∞–ø–∫–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã");
                    if (courses.some(c => c.name === dirHandle.name)) return alert("–≠—Ç–æ—Ç –∫—É—Ä—Å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω");
                    setCourses([...courses, {
                        id: Math.random().toString(36).substr(2, 9),
                        name: dirHandle.name,
                        displayName: dirHandle.name, 
                        structure: structure,
                        completed: {},
                        ratings: {}, excluded: {},
                        expanded: {}, 
                        createdAt: new Date().toISOString()
                    }]);
                } catch (err) { if (err.name !== 'AbortError') console.error(err); }
            };

            const handleRescan = async (courseId) => {
                try {
                    const course = courses.find(c => c.id === courseId);
                    alert(`–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É: ${course.name}`);
                    const dirHandle = await window.showDirectoryPicker();
                    if (dirHandle.name !== course.name) {
                        if(!confirm("–ò–º—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–∞–ø–∫–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ –∫—É—Ä—Å–∞. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?")) return;
                    }
                    const newStructure = await scanEntry(dirHandle);
                    if (!newStructure) return alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–∫–∏");
                    const mergedStructure = mergeStructure(newStructure, course.structure);
                    setCourses(courses.map(c => c.id === courseId ? { ...c, structure: mergedStructure } : c));
                    alert("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!");
                } catch (err) { if (err.name !== 'AbortError') console.error(err); }
            };
            
            const saveName = (id, newName) => {
                if (newName.trim()) { setCourses(courses.map(c => c.id === id ? { ...c, displayName: newName } : c)); }
                setEditingId(null);
            };

            const handleExport = () => {
                const dataStr = JSON.stringify(courses, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.download = `vibe_backup_${new Date().toISOString().slice(0,10)}.json`;
                link.href = url;
                link.click();
            };

            const handleImportFile = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedCourses = JSON.parse(event.target.result);
                        if (Array.isArray(importedCourses)) {
                            if(confirm("–≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?")) {
                                setCourses(importedCourses);
                                alert("–î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!");
                            }
                        } else { alert("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞"); }
                    } catch (err) { alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞"); }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const handleDelete = (e, id) => {
                e.stopPropagation();
                if (confirm('–£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å?')) {
                    setCourses(courses.filter(c => c.id !== id));
                    if (activeCourseId === id) setActiveCourseId(null);
                }
            };

            // MODIFIED FOR AUTO-SAVE TRIGGER AND CELEBRATION
            const toggleFile = (courseId, fileId) => {
                setCourses(prevCourses => {
                    return prevCourses.map(c => {
                        if (c.id !== courseId) return c;
                        
                        const oldCompleted = countCompletedFiles(c.structure, c.completed, c.excluded);
                        const total = countFiles(c.structure, c.excluded);
                        const oldPercent = total === 0 ? 0 : Math.round((oldCompleted / total) * 100);

                        const newCompleted = { ...c.completed };
                        if (newCompleted[fileId]) delete newCompleted[fileId]; else newCompleted[fileId] = true;
                        
                        // Check if newly 100%
                        const newCompletedCount = countCompletedFiles(c.structure, newCompleted, c.excluded);
                        const newPercent = total === 0 ? 0 : Math.round((newCompletedCount / total) * 100);

                        if (newPercent === 100 && oldPercent < 100) {
                            setNotification({msg: '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ö—É—Ä—Å –ø—Ä–æ–π–¥–µ–Ω! üéâ', type: 'celebration'});
                        }

                        return { ...c, completed: newCompleted };
                    });
                });
                setUnsavedChanges(true);
            };

            const rateFile = (courseId, fileId, rating) => {
                setCourses(courses.map(c => {
                    if (c.id !== courseId) return c;
                    const newRatings = { ...(c.ratings || {}) };
                    if (newRatings[fileId] === rating) delete newRatings[fileId];
                    else newRatings[fileId] = rating;
                    return { ...c, ratings: newRatings };
                }));
                setUnsavedChanges(true);
            };
            const toggleExclude = (courseId, fileId) => {
                setCourses(courses.map(c => {
                    if (c.id !== courseId) return c;
                    const newExcluded = { ...(c.excluded || {}) };
                    if (newExcluded[fileId]) delete newExcluded[fileId]; else newExcluded[fileId] = true;
                    return { ...c, excluded: newExcluded };
                }));
                setUnsavedChanges(true);
            };
            const toggleFolder = (courseId, folderId) => {
                setCourses(courses.map(c => {
                    if (c.id !== courseId) return c;
                    const newExpanded = { ...(c.expanded || {}) };
                    if (newExpanded[folderId]) delete newExpanded[folderId]; else newExpanded[folderId] = true;
                    return { ...c, expanded: newExpanded };
                }));
                setUnsavedChanges(true);
            };


            const getProgress = (course) => {
                const total = countFiles(course.structure, course.excluded);
                const done = countCompletedFiles(course.structure, course.completed, course.excluded);
                if (total === 0) return 0;
                // RETURN RAW NUMBER (e.g. 12.5) for precision
                return (done / total) * 100;
            };

            // --- Cloud Sync Logic ---
            // FIXED: WRAP IN OBJECT to avoid empty array rejection by API
            const handleCloudUpload = async (setStatus, setMsg) => {
                if(!cloudConfig.key || !cloudConfig.binId) {
                    if(setStatus) setStatus('error'); 
                    if(setMsg) setMsg('–ù–µ—Ç –∫–ª—é—á–µ–π');
                    else showToast('–ù–µ—Ç –∫–ª—é—á–µ–π JSONBin', 'error');
                    return;
                }

                try {
                    // Use ref to get the absolute latest state
                    const currentCourses = coursesRef.current || [];

                    const response = await fetch(`https://api.jsonbin.io/v3/b/${cloudConfig.binId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': cloudConfig.key
                        },
                        // KEY FIX: Wrapping in object { courses: [] }
                        body: JSON.stringify({ courses: currentCourses }) 
                    });
                    if (response.ok) {
                        if(setStatus) { setStatus('success'); setMsg('–£—Å–ø–µ—à–Ω–æ –≤—ã–≥—Ä—É–∂–µ–Ω–æ –≤ –æ–±–ª–∞–∫–æ!'); }
                        else showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –æ–±–ª–∞–∫–æ!');
                        setUnsavedChanges(false);
                    } else {
                        throw new Error('–û—à–∏–±–∫–∞ API');
                    }
                } catch (e) {
                    console.error("Cloud Upload Error:", e);
                    if(setStatus) { setStatus('error'); setMsg('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è'); }
                    else showToast('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                }
            };

            const handleCloudDownload = async (setStatus, setMsg) => {
                try {
                    const response = await fetch(`https://api.jsonbin.io/v3/b/${cloudConfig.binId}`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': cloudConfig.key,
                             'X-Bin-Meta': 'false' 
                        }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        let coursesData = data.record || data; 
                        
                        // Handle wrapped format (new) vs raw array (old)
                        if (coursesData.courses && Array.isArray(coursesData.courses)) {
                            coursesData = coursesData.courses;
                        }

                        if (Array.isArray(coursesData)) {
                            setCourses(coursesData);
                            if(setStatus) {
                                setStatus('success');
                                setMsg('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                                setTimeout(() => { setShowCloud(false); setStatus(null); }, 1500);
                            } else {
                                showToast('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                            }
                        } else {
                            // If it's not an array and not a wrapper, it might be an empty object if initialized manually
                            console.warn("Unexpected data format", coursesData);
                            // Fallback to empty if it looks like a fresh bin
                            if (Object.keys(coursesData).length === 0) {
                                setCourses([]);
                            } else {
                                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±–ª–∞–∫–µ');
                            }
                        }
                    } else {
                        throw new Error('–û—à–∏–±–∫–∞ API');
                    }
                } catch (e) {
                    if(setStatus) { setStatus('error'); setMsg('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è'); }
                    console.error(e);
                }
            };


            if (showHelp) return <HelpScreen onClose={() => setShowHelp(false)} />;

            if (activeCourseId) {
                const course = courses.find(c => c.id === activeCourseId);
                if (!course) return setActiveCourseId(null);
                const progress = getProgress(course);
                const displayProgress = progress % 1 === 0 ? progress.toFixed(0) : progress.toFixed(1);


                return (
                    <div className="max-w-5xl mx-auto min-h-screen pb-20">
                         {notification && <Toast message={notification.msg} type={notification.type} onClose={() => setNotification(null)} />}
                        
                        {/* Floating Save Button - appears when changes are unsaved AND Cloud is configured */}
                        {unsavedChanges && isCloudConfigured && (
                            <button 
                                onClick={() => handleCloudUpload(null, null)}
                                className="fixed bottom-6 left-1/2 -translate-x-1/2 z-40 bg-accent text-black font-bold px-6 py-4 rounded-full shadow-[0_0_30px_rgba(39,213,102,0.4)] flex items-center gap-3 animate-slide-up-centered hover:scale-105 transition-transform whitespace-nowrap"
                            >
                                <IconCloud /> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                            </button>
                        )}

                        <div className="sticky top-0 z-20 bg-[#0F0F0F]/95 backdrop-blur-md mb-8 shadow-2xl">
                            <div className="max-w-5xl mx-auto px-6 py-5">
                                <div className="flex items-center justify-between mb-6">
                                    <button onClick={() => { setActiveCourseId(null); setUnsavedChanges(false); }} className="flex items-center gap-2 text-subtext hover:text-white transition-colors bg-card hover:bg-hover px-5 py-2.5 rounded-xl border border-border font-medium">
                                        <IconBack /> –ù–∞–∑–∞–¥
                                    </button>
                                    <div className="text-right flex items-center gap-4">
                                        <span className="text-sm font-mono text-subtext uppercase tracking-widest hidden sm:inline">–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</span>
                                        <div className="text-3xl font-bold text-accent">{displayProgress}%</div>
                                    </div>
                                </div>
                                <div className="h-5 w-full bg-card rounded-full overflow-hidden border border-white/5 relative">
                                    <div className="absolute inset-0 bg-white/5"></div>
                                    <div className="h-full bg-gradient-to-r from-green-500 to-emerald-400 shadow-[0_0_20px_rgba(16,185,129,0.5)] transition-all duration-500 ease-out relative" style={{width: `${progress}%`}}></div>
                                </div>
                                <div className="flex justify-between items-end mt-6">
                                    <h1 className="text-4xl font-bold tracking-tight text-white leading-tight">{course.displayName || course.name}</h1>
                                    <button onClick={() => handleRescan(course.id)} className="flex items-center gap-2 text-sm text-subtext hover:text-accent hover:bg-accent/10 px-3 py-2 rounded-lg transition-all" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –ø—Ä–æ–≥—Ä–µ—Å—Å">
                                        <IconRefresh /> –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div className="px-6">
                            <div className="bg-card rounded-3xl p-8 border border-border/50 shadow-inner">
                                {course.structure.children.map(child => (
                                    <FileTree key={child.id} node={child} completedMap={course.completed} ratingsMap={course.ratings || {}} excludedMap={course.excluded || {}} expandedMap={course.expanded || {}} onToggle={(fileId) => toggleFile(course.id, fileId)} onRate={(fileId, rating) => rateFile(course.id, fileId, rating)} onExclude={(fileId) => toggleExclude(course.id, fileId)} onToggleFolder={(folderId) => toggleFolder(course.id, folderId)} />
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            const sortedCourses = [...courses]
                .map(c => ({ course: c, progress: getProgress(c) }))
                .sort((a, b) => {
                    if (a.progress === b.progress) {
                        const aDate = a.course.createdAt || '';
                        const bDate = b.course.createdAt || '';
                        return aDate.localeCompare(bDate);
                    }
                    return a.progress - b.progress;
                })
                .map(item => item.course);

            const completedCount = sortedCourses.filter(c => getProgress(c) === 100).length;
            const inProgressCount = sortedCourses.filter(c => {
                const p = getProgress(c);
                return p > 0 && p < 100;
            }).length;

            return (
                <div className="max-w-4xl mx-auto p-6 md:p-10 min-h-screen">
                    {showCloud && (
                        <CloudSyncModal 
                            onClose={() => setShowCloud(false)} 
                            onSync={handleCloudUpload}
                            onLoad={handleCloudDownload}
                            config={cloudConfig}
                            setConfig={setCloudConfig}
                        />
                    )}
                    {notification && <Toast message={notification.msg} type={notification.type} onClose={() => setNotification(null)} />}

                    <header className="flex flex-col gap-6 pt-4 mb-10">
                        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <div className="flex items-center gap-5">
                                <div className="w-16 h-16 bg-gradient-to-br from-green-900/40 to-black rounded-2xl border border-accent/20 flex items-center justify-center text-accent shadow-2xl shadow-accent/10">
                                    <svg viewBox="0 0 512 512" fill="none" stroke="currentColor" strokeWidth="32" strokeLinecap="round" strokeLinejoin="round" className="w-8 h-8 overflow-visible">
                                        <g transform-origin="center" transform="scale(1.35)">
                                            <path d="M256 130L48 240L256 350L464 240L256 130Z"/>
                                            <path d="M112 274V380C112 380 160 420 256 420C352 420 400 380 400 380V274"/>
                                            <line x1="464" y1="240" x2="464" y2="360" />
                                            <rect x="444" y="360" width="40" height="50" rx="10" fill="currentColor" stroke="none"/>
                                        </g>
                                    </svg>
                                </div>
                                <div>
                                    <h1 className="text-3xl sm:text-4xl font-bold text-white tracking-tight flex items-center gap-3">
                                        –ú–æ–∏ –ö—É—Ä—Å—ã
                                        <span className="bg-accent/10 text-accent text-xs px-2 py-0.5 rounded-full border border-accent/20 tracking-normal font-mono relative -top-1">v1.24</span>
                                    </h1>
                                    <p className="text-subtext text-lg mt-1">–õ–æ–∫–∞–ª—å–Ω—ã–π —Ç—Ä–µ–∫–µ—Ä –æ–±—É—á–µ–Ω–∏—è</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-3">
                                <input type="file" ref={fileInputRef} onChange={handleImportFile} className="hidden" accept=".json" />
                                <button onClick={() => setShowHelp(true)} className="flex items-center gap-2 text-sm font-medium text-subtext hover:text-white bg-card hover:bg-hover px-3 py-2 rounded-lg border border-border transition-colors" title="–°–ø—Ä–∞–≤–∫–∞">
                                    <IconHelp />
                                </button>
                                <button onClick={() => setShowCloud(true)} className="flex items-center gap-2 text-sm font-medium text-subtext hover:text-white bg-card hover:bg-hover px-3 py-2 rounded-lg border border-border transition-colors">
                                    <IconCloud />
                                </button>
                                <button onClick={handleExport} className="flex items-center gap-2 text-sm font-medium text-subtext hover:text-white bg-card hover:bg-hover px-3 py-2 rounded-lg border border-border transition-colors">
                                    <IconDownload /> –ë—ç–∫–∞–ø
                                </button>
                                <button onClick={() => fileInputRef.current.click()} className="flex items-center gap-2 text-sm font-medium text-subtext hover:text-white bg-card hover:bg-hover px-3 py-2 rounded-lg border border-border transition-colors">
                                    <IconUpload /> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </header>

                    {courses.length > 0 && (
                        <div className="mb-6 flex flex-wrap items-center gap-3 text-sm">
                            
                            <div className={`rounded-2xl border px-4 py-2 flex items-center gap-3 transition-all duration-300
                                ${completedCount > 0 
                                    ? 'bg-gradient-to-br from-green-900/40 to-black border-accent/50 shadow-[0_0_15px_rgba(39,213,102,0.15)] text-white' 
                                    : 'bg-card border-border'
                                }`}>
                                <span className="text-2xl">üèÜ</span>
                                <div className="flex items-baseline gap-2">
                                    <span className="text-xs uppercase tracking-widest text-subtext/70 font-mono">–ü—Ä–æ–π–¥–µ–Ω–æ</span>
                                    <span className={`text-lg font-semibold ${completedCount > 0 ? 'text-accent' : 'text-white'}`}>{completedCount}</span>
                                </div>
                            </div>

                            <div className="bg-card rounded-2xl border border-border px-4 py-2 flex items-center gap-3">
                                <span className="text-2xl">üî®</span>
                                <div className="flex items-baseline gap-2">
                                    <span className="text-xs uppercase tracking-widest text-subtext/70 font-mono">–í —Ä–∞–±–æ—Ç–µ</span>
                                    <span className="text-lg font-semibold text-white">{inProgressCount}</span>
                                </div>
                            </div>
                        </div>
                    )}

                    <QuoteBlock />
                    
                    {/* Main Big Cloud Save Button - ONLY VISIBLE IF KEYS EXIST */}
                    {isCloudConfigured && (
                        <button onClick={() => handleCloudUpload(null, null)} className="w-full flex items-center justify-center gap-3 bg-accent text-black px-8 py-3 rounded-2xl font-bold text-lg hover:bg-green-400 transition-all active:scale-95 shadow-lg shadow-accent/20 mb-4">
                            <IconCloud /> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Cloud
                        </button>
                    )}

                    <button onClick={handleAddCourse} className="w-full flex items-center justify-center gap-3 bg-white text-black px-8 py-4 rounded-2xl font-bold text-lg hover:bg-gray-200 transition-all active:scale-95 shadow-xl shadow-white/5 mb-10">
                        <IconPlus /> –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å
                    </button>

                    <div className="space-y-6">
                        {courses.length === 0 ? (
                            <div onClick={handleAddCourse} className="border-3 border-dashed border-border rounded-3xl h-80 flex flex-col items-center justify-center text-subtext cursor-pointer hover:border-accent hover:text-accent transition-all bg-card/30 group">
                                <div className="p-6 bg-card rounded-full mb-6 group-hover:scale-110 transition-transform shadow-lg">
                                    <IconMortarboard size={56} className="text-subtext" />
                                </div>
                                <p className="text-xl font-bold">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</p>
                                <p className="text-base opacity-60 mt-2">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–∞–ø–∫—É —Å –∫—É—Ä—Å–æ–º</p>
                            </div>
                        ) : (
                            sortedCourses.map(course => {
                                const progress = getProgress(course);
                                const isDone = progress === 100;

                                return (
                                    <div 
                                        key={course.id}
                                        onClick={() => setActiveCourseId(course.id)}
                                        className="group bg-card border border-border rounded-3xl p-5 sm:p-7 cursor-pointer hover:border-gray-600 hover:bg-[#1C1C20] transition-all hover:shadow-2xl flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 sm:gap-8 relative overflow-hidden"
                                    >
                                        <div className="flex items-center gap-4 sm:gap-8 min-w-0 flex-1 w-full sm:w-auto">
                                            
                                            <div className={`shrink-0 w-16 h-16 sm:w-24 sm:h-24 rounded-2xl flex items-center justify-center transition-all duration-300 shadow-lg overflow-hidden
                                                ${isDone 
                                                    ? 'bg-gradient-to-br from-green-900/20 to-black border border-accent text-accent shadow-[0_0_15px_rgba(39,213,102,0.15)]' 
                                                    : 'bg-[#0F0F0F] border border-border text-subtext group-hover:text-white group-hover:border-gray-600'
                                                }`}>
                                                <IconMortarboard size={64} />
                                            </div>

                                            <div className="min-w-0 py-2 flex-1">
                                                {editingId === course.id ? (
                                                    <input 
                                                        ref={editInputRef}
                                                        defaultValue={course.displayName || course.name}
                                                        onClick={(e) => e.stopPropagation()}
                                                        onKeyDown={(e) => {
                                                            if (e.key === 'Enter') saveName(course.id, e.target.value);
                                                            if (e.key === 'Escape') setEditingId(null);
                                                        }}
                                                        onBlur={(e) => saveName(course.id, e.target.value)}
                                                        className="bg-[#0F0F0F] text-2xl font-bold text-white w-full border border-accent rounded-lg px-2 py-1 outline-none"
                                                    />
                                                ) : (
                                                    <div className="group/title flex items-center gap-3">
                                                        <h3 className="text-xl sm:text-2xl font-bold text-gray-100 group-hover:text-white truncate transition-colors mb-2 leading-tight" title={course.name}>
                                                            {course.displayName || course.name}
                                                        </h3>
                                                        <button 
                                                            onClick={(e) => { e.stopPropagation(); setEditingId(course.id); }}
                                                            className="opacity-100 text-subtext hover:text-accent transition-opacity p-1 mb-2"
                                                            title="–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ"
                                                        >
                                                            <IconEdit />
                                                        </button>
                                                    </div>
                                                )}
                                                
                                                <div className="flex items-center gap-3">
                                                    <span className="bg-[#27272A] px-3 py-1 rounded-lg text-sm font-mono text-subtext border border-white/5">
                                                        {countFiles(course.structure)} —Ñ–∞–π–ª–æ–≤
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex items-center justify-between sm:justify-end gap-4 sm:gap-8 shrink-0 z-10 w-full sm:w-auto pt-4 sm:pt-0 border-t sm:border-t-0 sm:border-l border-white/5 sm:h-20 sm:pl-4">
                                            <div className="hover:scale-105 transition-transform">
                                                <CircularProgress percentage={progress} size={80} strokeWidth={8} />
                                            </div>
                                            <button onClick={(e) => handleDelete(e, course.id)} className="text-subtext hover:text-red-500 p-3 rounded-xl hover:bg-white/10 transition-colors opacity-100" title="–£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å">
                                                <IconTrash />
                                            </button>
                                        </div>
                                    </div>
                                )
                            })
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>